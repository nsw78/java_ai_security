spring:
  application:
    name: ai-security-api
  
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/ai_security_db}
    username: ${SPRING_DATASOURCE_USERNAME:${DB_USERNAME:postgres}}
    password: ${SPRING_DATASOURCE_PASSWORD:${DB_PASSWORD:postgres}}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
  
  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    open-in-view: false
  
  data:
    redis:
      host: ${REDIS_HOST:localhost}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 2000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0
  
  security:
    jwt:
      secret: ${JWT_SECRET:YWJjZGVmZ2hpamsxMjM0NTY3ODkwYWJjZGVmZ2hpamsxMjM0NTY3ODkwYWJjZGVmZ2hpamsxMjM0NTY3ODkw}
      expiration: 86400000 # 24 hours

server:
  port: ${SERVER_PORT:8080}
  error:
    include-message: always
    include-binding-errors: always

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized

springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    tags-sorter: alpha
    operations-sorter: alpha

app:
  security:
    # Prompt Injection Detection
    injection:
      enabled: true
      patterns:
        - "(?i)(ignore|forget|disregard).*(previous|above|instructions)"
        - "(?i)(system|assistant).*(you are|you're|your role)"
        - "(?i)(new instructions|new prompt|override)"
        - "(?i)(\\[INST\\]|\\[/INST\\]|<|>)"
        - "(?i)(jailbreak|bypass|hack)"
        - "(?i)(repeat|say|output).*(word|phrase|text)"
        - "(?i)(\\$\\{|\\{\\{|\\[\\[)"
    
    # Rate Limiting
    rate-limit:
      enabled: true
      default-limit: 100
      default-window: 60 # seconds
      limits:
        free: 50
        premium: 500
        enterprise: 10000
    
    # Risk Score
    risk:
      enabled: true
      thresholds:
        low: 30
        medium: 60
        high: 80
    
    # Policy Engine
    policy:
      enabled: true
      default-policy: restrictive
      policies:
        restrictive:
          allow-external-apis: false
          max-prompt-length: 4000
          allowed-domains: []
        moderate:
          allow-external-apis: true
          max-prompt-length: 8000
          allowed-domains: ["openai.com", "anthropic.com"]
        permissive:
          allow-external-apis: true
          max-prompt-length: 16000
          allowed-domains: ["*"]
    
    # Audit Logging
    audit:
      enabled: true
      retention-days: 90
      log-sensitive-data: false

logging:
  level:
    root: INFO
    com.trustai: INFO
    com.trustai.exception: WARN
    com.trustai.util.StructuredLogger: INFO
    org.springframework: WARN
    org.springframework.security: INFO
    org.hibernate: WARN
    org.apache: WARN
    io.lettuce: WARN
    com.zaxxer.hikari: WARN
  config: classpath:logback-spring.xml

